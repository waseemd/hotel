// dateTimePicker
var DateTimePicker=function(a){if(!(this instanceof DateTimePicker)){return new DateTimePicker(a)}this.init.call(this,a);return this};DateTimePicker.prototype={init:function(a){a=$.extend({trigger:["focus"],wrap_class:"datetimepicker",day_name:["Su","Mo","Tu","We","Th","Fr","Sa"],month_name:["January","February","March","April","May","June","July","August","September","October","November","December"],day_first:0,picker:["date","time"],min_step:5,time_name:["AM","PM"],paging:['<i class="icon-i-arrow-left"></i>','<i class="icon-i-arrow-right"></i>'],timezone_title:null,get_utc:false,format:"m/d/Y h:i A",filter:function(){return true},filter_show:function(){return true},afterDraw:function(){},onChange:function(){},parse_only:false},a);this.options=a;if(this.options.parse_only){$(this.options.element).html(this.formatResult(new Date(Date.parse($(a.element).html()))));return}a.day_name=a.day_name.slice(a.day_first).concat(a.day_name.slice(0,a.day_first));a.day_index=[];for(var b=0;b<a.day_name.length;b++){a.day_index.push((a.day_first+b+7)%7)}this.picker=$("<div>").addClass("hide").addClass(a.wrap_class);this.date=new Date();if($(a.element).val()!=""){this.date=new Date(Date.parse($(a.element).val()))}if(isNaN(this.date.getTime())){this.date=new Date();this.date.setMinutes(this.date.getMinutes()-(this.date.getMinutes()%this.options.min_step))}this.date_show=new Date(this.date.getTime());if(a.get_utc){a.utc=$("<input>").prop({name:$(this.options.element).prop("name")+"_UTC",type:"hidden"});$(a.element).before(a.utc)}this.reloadPicker();var c=this;$(a.element).prop("readonly",true).addClass("datetime-picker").wrap($("<div>").css({display:$(a.element).css("display"),position:"relative"}).click(function(d){c.prevent_blur=true})).after(c.picker);$(a.element).focus(function(d){$(c.picker).css({position:"absolute",overflow:"visible",top:$(a.element).outerHeight()+"px",left:"0px"}).removeClass("hide").parent().css({"z-index":1000})});$(document).bind("click",function(){if(!c.prevent_blur){$(c.picker).addClass("hide").parent().css({"z-index":1})}c.prevent_blur=false})},formatResult:function(b){var a=this.options.format;a=a.replace("m",this.string2(b.getMonth()+1)).replace("d",this.string2(b.getDate())).replace("Y",this.string2(b.getFullYear())).replace("H",this.string2(b.getHours())).replace("h",this.get12Hours(b.getHours())).replace("A",this.getAmPm(b.getHours())).replace("i",this.string2(b.getMinutes()));return a},reloadPicker:function(){var a=this;this.picker.empty();if(this.options.picker.indexOf("date")!==-1){$(this.picker).append(this.getDatePicker(this.date_show))}if(this.options.picker.indexOf("time")!==-1){$(this.picker).append(this.getTimePicker())}if(this.options.timezone_title){$(this.picker).append($("<div>").addClass("timezone").append(this.options.timezone_title))}$(this.options.element).val(this.formatResult(this.date));if(this.options.utc){$(this.options.utc).val(this.date.toUTCString())}$(".time-picker:eq(0)",this.picker).css({"margin-left":"0px"});this.options.afterDraw.call(this)},getDatePicker:function(c){var e=this;var h=new Date(c.getTime());h.setDate(1);var g=h.getDay();h.setMonth(h.getMonth()+1);h.setDate(0);var a=h.getDate();var f=g-e.options.day_index[0];var b=Math.ceil((f+a)/7);return[$("<div>").addClass("paging").append(function(){return[$("<span>").addClass("prev").append(e.options.paging[0]).click(function(){e.date_show.setMonth(e.date_show.getMonth()-1);if(e.options.filter_show(e.date_show)){e.reloadPicker()}else{e.date_show.setMonth(e.date_show.getMonth()+1)}}),$("<div>").append([e.options.month_name[h.getMonth()],", ",h.getFullYear()]),$("<span>").addClass("next").append(e.options.paging[1]).click(function(){e.date_show.setMonth(e.date_show.getMonth()+1);if(e.options.filter_show(e.date_show)){e.reloadPicker()}else{e.date_show.setMonth(e.date_show.getMonth()-1)}})]}),$("<table>").append(function(){return[$("<thead>").append(function(){return $(e.options.day_name).map(function(d,i){return $("<td>").append(i)}).toArray()}),$("<tbody>").append(function(){var j=[];for(var d=0;d<b;d++){j.push($("<tr>").append(function(){var k=[];for(var i=0;i<7;i++){var m=new Date(c.getTime());m.setDate(-f+(i+1)+(d*7));var l=e.options.filter.call(e,m);k.push($("<td>").addClass(function(){var n=[];if(!l){n.push("unvailable")}if(m.getDate()==e.date.getDate()&&m.getMonth()==e.date.getMonth()&&m.getFullYear()==e.date.getFullYear()){n.push("cur-date")}if(m.getMonth()==c.getMonth()){n.push("cur-month")}else{n.push("near-month")}return n.join(" ")}).data({date:m,available:l}).append(m.getDate()).click(function(){if(e.options.picker.indexOf("time")===-1){$(document).triggerHandler("click")}if($(this).data("available")){var n=$(this).data("date");n.setHours(e.date.getHours());n.setMinutes(e.date.getMinutes());n.setSeconds(e.date.getSeconds());e.date=new Date(n.getTime());e.date_show=new Date(n.getTime());e.options.onChange.call(e);e.reloadPicker()}}))}return k}))}return j})]})]},getTimePicker:function(){var a=this;return $("<div>").append(function(){return[$("<select>").append(function(){var c=[];var e=new Date(a.date.getTime());e.setMinutes(0);for(var b=0;b<24;b++){e.setHours(b);c.push($("<option>").prop({selected:(b==a.date.getHours()),hidden:a.options.filter.call(a,e)!=1}).val(b).append(function(){return a.get12Hours(b)+"&nbsp;"+a.getAmPm(b)}))}return c}).change(function(){a.date.setHours($(this).val());a.options.onChange.call(a);a.reloadPicker()}),$("<select>").append(function(){var c=[];var e=new Date(a.date.getTime());for(var b=0;b<60;b=b+a.options.min_step){e.setMinutes(b);c.push($("<option>").prop({selected:(b==a.date.getMinutes()),hidden:a.options.filter.call(a,e)!=1}).val(b).append(a.string2(b)))}return c}).change(function(){a.date.setMinutes($(this).val());a.options.onChange.call(a);a.reloadPicker()})]})},string2:function(a){a=a.toString();return(a.length>1)?a:"0"+a},getAmPm:function(a){return(a<12)?this.options.time_name[0]:this.options.time_name[1]},get12Hours:function(a){var b=(a<12)?a:(a-12);if(b==0){b=12}return this.string2(b)}};$.fn.dateTimePicker=function(a){return this.each(function(){var b=$(this).data("DateTimePicker");if(!b){a.element=this;$(this).data("DateTimePicker",new DateTimePicker(a))}if(typeof a==="string"){$(this).data("DateTimePicker")[a].call(this)}})};$.fn.dateTimePickerRange=function(){var b=$(this).eq(0).data("DateTimePicker");b.options.onChange=function(){if(!a.options.filter(a.date)){a.date=new Date(this.date.getTime());a.date_show=new Date(this.date.getTime())}a.reloadPicker()};var a=$(this).eq(1).data("DateTimePicker");a.options.filter=function(c){if(c.getTime()<b.date.getTime()){return false}else{return true}};a.options.filter_show=function(c){return c.getYear()>=b.date.getYear()&&c.getMonth()>=b.date.getMonth()};b.options.onChange.call(b);return this};
